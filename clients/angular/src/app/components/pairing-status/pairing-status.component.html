<div class="pairing-status-container">
  <mat-card class="status-card">
    <mat-card-header>
      <mat-card-title>Pairing in Progress</mat-card-title>
      <mat-card-subtitle>Pairing ID: {{ pairingId }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="status-content">
        <!-- Loading Spinner -->
        @if (isPolling && !errorMessage) {
        <div class="spinner-container">
          <mat-spinner diameter="50"></mat-spinner>
        </div>
      }

        <!-- Status Message -->
        <div class="status-message">
          <mat-icon [class.success]="currentStatus === 'ACTIVE'">
            {{ getStatusIcon() }}
          </mat-icon>
          <p>{{ statusMessage }}</p>
        </div>

        <!-- Progress Bar -->
        @if (isPolling || currentStatus !== 'ACTIVE') {
        <div class="progress-section">
          <mat-progress-bar
            mode="determinate"
            [value]="progress"
            [class.completed]="currentStatus === 'ACTIVE'">
          </mat-progress-bar>
          <p class="progress-text">{{ progress.toFixed(0) }}%</p>
        </div>
        }

        <!-- Error Section -->
        @if (errorMessage) {
        <div class="error-section">
          <mat-icon class="error-icon">error</mat-icon>
          <p class="error-text">{{ errorMessage }}</p>
        </div>
        }

        <!-- Success Section -->
        @if (currentStatus === 'ACTIVE') {
        <div class="success-section">
          <mat-icon class="success-icon">check_circle</mat-icon>
          <p class="success-text">Device successfully paired!</p>
        </div>
        }

        <!-- Status Timeline -->
        <div class="status-timeline">
          <div class="timeline-item" [class.active]="stagesArray.indexOf('PENDING_ADMIN_APPROVAL') <= stagesArray.indexOf(currentStatus)">
            <div class="timeline-dot"></div>
            <p>Pending Approval</p>
          </div>
          <div class="timeline-item" [class.active]="stagesArray.indexOf('APPROVED_PENDING_CALLBACK') <= stagesArray.indexOf(currentStatus)">
            <div class="timeline-dot"></div>
            <p>Callback</p>
          </div>
          <div class="timeline-item" [class.active]="stagesArray.indexOf('APPROVED_AWAITING_POLL') <= stagesArray.indexOf(currentStatus)">
            <div class="timeline-dot"></div>
            <p>Poll</p>
          </div>
          <div class="timeline-item" [class.active]="currentStatus === 'ACTIVE'">
            <div class="timeline-dot"></div>
            <p>Complete</p>
          </div>
        </div>
      </div>
    </mat-card-content>

    <!-- Actions -->
    @if (!isPolling) {
    <mat-card-actions>
      @if (errorMessage) {
      <button mat-button (click)="retry()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
      }
      <button mat-button (click)="cancel()">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </mat-card-actions>
    }
  </mat-card>
</div>
